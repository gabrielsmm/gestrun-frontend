<div class="bg-white p-6 rounded-lg shadow-md">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-2xl font-bold text-gray-700">Resultados</h2>
    <!-- Autocomplete para selecionar a corrida -->
    <mat-form-field appearance="fill" class="w-100">
      <mat-label>Buscar Corrida</mat-label>
      <input
        type="text"
        matInput
        [matAutocomplete]="auto"
        [(ngModel)]="corridaSelecionadaNome"
        (input)="filtrarCorridas($event.target.value)"
        placeholder="Digite o nome da corrida"
      >
      <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selecionarCorrida($event.option.value)">
        @for (corrida of corridasFiltradas; track corrida.id) {
          <mat-option [value]="corrida.nome">
            {{ corrida.nome }}
          </mat-option>
        }
      </mat-autocomplete>
    </mat-form-field>
  </div>

  @if (corridaSelecionada?.id) {
    <table mat-table [dataSource]="linhasResultados" class="w-full mat-elevation-z2">
      <!-- Número de Peito -->
      <ng-container matColumnDef="numeroPeito">
        <th mat-header-cell *matHeaderCellDef class="largura-fixa-180"> Nº Peito </th>
        <td mat-cell *matCellDef="let linha" class="largura-fixa-180">
          <mat-form-field appearance="fill" class="w-full mt-1 mb-1 form-field-compact">
            <mat-icon matPrefix class="icon-compact">badge</mat-icon>
            <input matInput
              #numeroPeitoInput
              type="text"
              mask="0000"
              [(ngModel)]="linha.numeroPeito"
              [disabled]="linha.resultadoId"
              (keyup.enter)="buscarInscricao(linha)"
              (blur)="buscarInscricao(linha)"
              placeholder="Nº Peito"
              class="input-compact no-spinner"
            />
          </mat-form-field>
        </td>
      </ng-container>
      <!-- Nome do Corredor -->
      <ng-container matColumnDef="nomeCorredor">
        <th mat-header-cell *matHeaderCellDef> Nome </th>
        <td mat-cell *matCellDef="let linha">
          <span class="font-medium">{{ linha.nomeCorredor || '-' }}</span>
        </td>
      </ng-container>
      <!-- Tempo -->
      <ng-container matColumnDef="tempo">
        <th mat-header-cell *matHeaderCellDef class="largura-fixa-180"> Tempo </th>
        <td mat-cell *matCellDef="let linha; let i = index;" class="largura-fixa-180">
          <mat-form-field appearance="fill" class="w-full mt-1 mb-1 form-field-compact">
            <mat-icon matPrefix class="icon-compact">timer</mat-icon>
            <input matInput
              mask="00:00:00"
              [dropSpecialCharacters]="false"
              [(ngModel)]="linha.tempo"
              placeholder="HH:MM:SS"
              [disabled]="!linha.inscricaoId"
              (keyup.enter)="salvarResultado(linha, i)"
              class="input-compact"
            />
          </mat-form-field>
        </td>
      </ng-container>
      <!-- Posição Geral -->
      <ng-container matColumnDef="posicaoGeral">
        <th mat-header-cell *matHeaderCellDef class="!text-center largura-maxima-180"> Posição Geral </th>
        <td mat-cell *matCellDef="let linha" class="!text-center largura-maxima-180">
          {{ linha.posicaoGeral || '-' }}
        </td>
      </ng-container>
      <!-- Ações -->
      <ng-container matColumnDef="acoes">
        <th mat-header-cell *matHeaderCellDef class="!text-center largura-fixa-180"> Ações </th>
        <td mat-cell *matCellDef="let linha; let i = index;" class="!text-center largura-fixa-180">
          <button mat-icon-button color="primary"
            [disabled]="!linha.inscricaoId"
            (click)="salvarResultado(linha, i)">
            <mat-icon>save</mat-icon>
          </button>
          <button mat-icon-button color="warn"
            [disabled]="!linha.resultadoId"
            (click)="excluirResultado(linha)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="colunas"></tr>
      <tr mat-row *matRowDef="let row; columns: colunas;"></tr>
    </table>
  }
  @else {
    <div class="text-center text-gray-500 py-8">
      Selecione uma corrida para lançar resultados.
    </div>
  }
</div>
